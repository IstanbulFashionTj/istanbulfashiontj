<!DOCTYPE html>
<html lang="tg" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ҳисоби ман - Istanbul Fashion Tj</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="icon" type="image/png" href="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png" />

    <script>
        const API_BASE = window.location.hostname.includes('localhost') 
            ? 'http://localhost:5000' 
            : 'https://istanbulfashiontj.pythonanywhere.com';

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5FBF',
                        'primary-dark': '#6D28D9',
                        accent: '#F59E0B',
                        'accent-dark': '#D97706',
                        dark: '#0F172A',
                        light: '#F8FAFC',
                        surface: '#FFFFFF',
                        danger: '#EF4444'
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Manrope', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .mobile-menu.open { transform: translateX(0); }

        /* Notification Styles */
        #app-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-150px);
            z-index: 9999;
            width: 90%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            opacity: 0;
            pointer-events: none;
        }

        #app-notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        #app-notification.success { border-left: 4px solid #10B981; }
        #app-notification.error { border-left: 4px solid #EF4444; }
        #app-notification.info { border-left: 4px solid #3B82F6; }

        .notif-icon-box {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.1rem;
        }
        .success .notif-icon-box { background: #D1FAE5; color: #10B981; }
        .error .notif-icon-box { background: #FEE2E2; color: #EF4444; }
        .info .notif-icon-box { background: #DBEAFE; color: #3B82F6; }

        .custom-input {
            transition: all 0.3s ease;
            background-color: #F8FAFC;
        }
        .custom-input:focus {
            background-color: #ffffff;
            border-color: #8B5FBF;
            box-shadow: 0 0 0 4px rgba(139, 95, 191, 0.1);
        }

        .tab-button {
            transition: all 0.3s;
            position: relative;
            text-align: left;
        }
        .tab-button:hover { background-color: #F1F5F9; }
        .tab-button.active {
            color: #8B5FBF;
            font-weight: 700;
            background-color: #F3F4F6;
        }
        .tab-button.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 60%;
            width: 4px;
            background-color: #8B5FBF;
            border-radius: 0 4px 4px 0;
        }
        
        .tab-content { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .tab-content.active { display: block; opacity: 1; }

        
        .order-card {
            transition: all 0.3s ease;
            border: 1px solid #E2E8F0;
        }
        .order-card:hover {
            border-color: #8B5FBF;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-light text-slate-800">

 
    <div id="app-notification">
        <div class="notif-icon-box">
            <i class="fas fa-check"></i>
        </div>
        <div class="flex-1 min-w-0">
            <p class="text-sm font-bold text-slate-800" id="notif-title">Огоҳӣ</p>
            <p class="text-xs text-slate-500 truncate" id="notif-message">Паём...</p>
        </div>
    </div>

    
    <header class="fixed w-full top-0 z-50 glass-nav transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="flex justify-between items-center h-16 sm:h-20">
                <button id="mobile-menu-btn" class="lg:hidden text-2xl text-dark hover:text-primary transition">
                    <i class="fas fa-bars"></i>
                </button>

                <a href="https://istanbulfashiontj.github.io/istanbul-fashion-web/" class="flex items-center gap-2 group">
                    <img src="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png" alt="Istanbul Wear" class="h-10 w-10 sm:h-12 sm:w-12 object-contain group-hover:scale-110 transition-transform">
                    <div class="hidden sm:block">
                        <h1 class="text-xl font-bold leading-none tracking-tight">ISTANBUL<span class="text-primary">FASHION TJ</span></h1>
                        <p class="text-[10px] text-slate-500 font-medium tracking-widest uppercase">Style from Turkey and Uzbekistan</p>
                    </div>
                </a>

                <nav class="hidden lg:flex items-center space-x-8">
                    <a href="index.html" class="text-sm font-semibold text-slate-600 hover:text-primary transition">Асосӣ</a>
                    <a href="magazin.html" class="text-sm font-semibold text-slate-600 hover:text-primary transition">Мағоза</a>
                    <a href="tamos.html" class="text-sm font-semibold text-slate-600 hover:text-primary transition">Тамос</a>
                    <a href="#" id="admin-link" class="hidden text-sm font-bold text-red-500 hover:text-red-700 transition px-3 py-1 bg-red-50 rounded-full">Панели АДМИН</a>
                </nav>

                <div class="flex items-center gap-2 sm:gap-4">
                    <a href="magazin.html" class="hidden sm:flex ml-2 px-5 py-2 bg-primary text-white text-sm font-semibold rounded-full hover:bg-primary-dark transition shadow-lg hover:shadow-primary/30 items-center">
                        <i class="fas fa-shopping-bag mr-2"></i> Харид
                    </a>
                    <button onclick="logout()" class="sm:hidden text-danger p-2"><i class="fas fa-sign-out-alt text-xl"></i></button>
                </div>
            </div>
        </div>
    </header>

    
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden backdrop-blur-sm transition-opacity"></div>
    <div id="mobile-menu" class="mobile-menu fixed top-0 left-0 h-full w-[80%] max-w-sm bg-white z-50 shadow-2xl overflow-y-auto">
        <div class="p-5">
            <div class="flex justify-between items-center mb-8">
                <span class="font-bold text-xl">Меню</span>
                <button id="close-menu-btn" class="text-slate-500 hover:text-danger p-2"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="bg-slate-50 rounded-xl p-4 mb-6 border border-slate-100 flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold" id="mobile-user-initials">
                    <i class="fas fa-user"></i>
                </div>
                <div class="overflow-hidden">
                    <p class="font-bold text-dark truncate" id="mobile-user-name">Меҳмон</p>
                    <p class="text-xs text-slate-500 truncate" id="mobile-user-email">email@example.com</p>
                </div>
            </div>
            
            <nav class="space-y-1">
                <a href="index.html" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-50 text-slate-600 font-medium transition">
                    <i class="fas fa-home w-5 text-center"></i> Асосӣ
                </a>
                <a href="magazin.html" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-50 text-slate-600 font-medium transition">
                    <i class="fas fa-store w-5 text-center"></i> Мағоза
                </a>
                <a href="tamos.html" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-50 text-slate-600 font-medium transition">
                    <i class="fas fa-headset w-5 text-center"></i> Тамос
                </a>
                <div class="border-t border-slate-100 my-4 pt-4">
                    <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-red-50 text-danger font-medium hover:bg-red-100 transition">
                        <i class="fas fa-sign-out-alt w-5 text-center"></i> Баромадан аз ҳисоб
                    </button>
                </div>
            </nav>
        </div>
    </div>

   
    <main class="pt-24 sm:pt-32 pb-20">
        <div class="container mx-auto px-4">
            <div class="max-w-6xl mx-auto">
                <div class="mb-10 text-center sm:text-left">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-dark mb-2">Кабинети Шахсӣ</h1>
                    <p class="text-slate-500">Хуш омадед ба панели идоракунии ҳисоби худ.</p>
                </div>

                <div class="flex flex-col lg:flex-row gap-8">
                    
                    <div class="lg:w-1/4">
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden sticky top-28">
                            <div class="p-6 border-b border-slate-50 bg-slate-50/50">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-primary to-accent rounded-full flex items-center justify-center text-white text-xl font-bold shadow-lg shadow-primary/20">
                                        <span id="user-initials">--</span>
                                    </div>
                                    <div class="overflow-hidden">
                                        <p id="user-name" class="font-bold text-dark truncate text-lg">Боргирӣ...</p>
                                        <p id="user-email" class="text-xs text-slate-500 truncate">email@example.com</p>
                                    </div>
                                </div>
                            </div>

                            <nav class="p-4 space-y-1">
                                <button onclick="switchTab('orders')" class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 transition active">
                                    <i class="fas fa-box w-5 text-center text-lg"></i> 
                                    <span class="flex-1 font-medium">Фармоишҳои ман</span>
                                    <span id="orders-count" class="text-xs bg-slate-200 text-slate-600 font-bold px-2 py-0.5 rounded-full">0</span>
                                </button>
                                <button onclick="switchTab('profile')" class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 transition">
                                    <i class="fas fa-user-circle w-5 text-center text-lg"></i> 
                                    <span class="font-medium">Маълумоти шахсӣ</span>
                                </button>
                                <button onclick="switchTab('password')" class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 transition">
                                    <i class="fas fa-lock w-5 text-center text-lg"></i> 
                                    <span class="font-medium">Ивази парол</span>
                                </button>
                                <button onclick="logout()" class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-xl text-danger hover:bg-red-50 transition mt-4">
                                    <i class="fas fa-sign-out-alt w-5 text-center text-lg"></i> 
                                    <span class="font-medium">Баромадан</span>
                                </button>
                            </nav>
                        </div>
                    </div>

                    
                    <div class="lg:w-3/4">
                        
                        
                        <div id="orders" class="tab-content active">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-dark">Таърихи Фармоишҳо</h2>
                                <button onclick="loadOrders()" class="text-primary hover:bg-primary/10 px-3 py-1 rounded-lg transition text-sm font-medium">
                                    <i class="fas fa-sync-alt mr-1"></i> Навсозӣ
                                </button>
                            </div>
                            
                            
                            <div id="orders-list" class="space-y-4 min-h-[200px]">
                                
                                <div class="text-center py-12">
                                    <i class="fas fa-circle-notch fa-spin text-primary text-3xl mb-4"></i>
                                    <p class="text-slate-500">Ҷустуҷӯи фармоишҳо...</p>
                                </div>
                            </div>

                            
                            <div id="no-orders-template" class="hidden">
                                <div class="bg-white rounded-2xl border border-slate-100 p-10 text-center shadow-sm">
                                    <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-300">
                                        <i class="fas fa-shopping-basket text-4xl"></i>
                                    </div>
                                    <h3 class="text-xl font-bold text-dark mb-2">Шумо ҳанӯз фармоиш надоред</h3>
                                    <p class="text-slate-500 mb-8 max-w-md mx-auto">Ба мағозаи мо ташриф оред ва либосҳои писандидаи худро интихоб кунед.</p>
                                    <a href="magazin.html" class="inline-flex items-center px-6 py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/30 hover:bg-primary-dark transition">
                                        Ба Мағоза <i class="fas fa-arrow-right ml-2"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        
                        <div id="profile" class="tab-content">
                            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 sm:p-8">
                                <h2 class="text-2xl font-bold text-dark mb-6">Танзимоти Профил</h2>
                                <form id="profile-form" class="space-y-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        
                                        <div>
                                            <label for="profile-name" class="block text-sm font-semibold text-slate-700 mb-2">Ному Насаб</label>
                                            <input type="text" id="profile-name" class="custom-input w-full px-4 py-3 rounded-xl border border-slate-200 text-sm focus:outline-none" required>
                                        </div>
                                        
                                        <div>
                                            <label for="profile-email" class="block text-sm font-semibold text-slate-700 mb-2">Email (Тағйирнопазир)</label>
                                            <input type="email" id="profile-email" class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-100 text-slate-500 text-sm cursor-not-allowed" disabled>
                                        </div>
                                       
                                        <div class="md:col-span-2">
                                            <label for="profile-phone" class="block text-sm font-semibold text-slate-700 mb-2">Рақами телефон</label>
                                            <input type="tel" id="profile-phone" class="custom-input w-full px-4 py-3 rounded-xl border border-slate-200 text-sm focus:outline-none" placeholder="+992 XX XXX XXXX">
                                        </div>
                                    </div>
                                    
                                    <div class="pt-4 border-t border-slate-100 flex justify-end">
                                        <button type="submit" id="profile-save-btn" class="bg-primary hover:bg-primary-dark text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-primary/20 transition transform active:scale-95 flex items-center">
                                            <i class="fas fa-save mr-2"></i> Захира кардан
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        
                        <div id="password" class="tab-content">
                            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 sm:p-8">
                                <h2 class="text-2xl font-bold text-dark mb-6">Иваз кардани парол</h2>
                                <form id="password-form" class="space-y-6 max-w-lg">
                                    
                                    <div>
                                        <label for="old-password" class="block text-sm font-semibold text-slate-700 mb-2">Пароли ҷорӣ</label>
                                        <div class="relative">
                                            <input type="password" id="old-password" class="custom-input w-full px-4 py-3 rounded-xl border border-slate-200 text-sm focus:outline-none" required>
                                            <button type="button" onclick="togglePassword('old-password', this)" class="absolute right-4 top-3.5 text-slate-400 hover:text-primary transition">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="new-password" class="block text-sm font-semibold text-slate-700 mb-2">Пароли нав</label>
                                        <div class="relative">
                                            <input type="password" id="new-password" class="custom-input w-full px-4 py-3 rounded-xl border border-slate-200 text-sm focus:outline-none" minlength="6" required>
                                            <button type="button" onclick="togglePassword('new-password', this)" class="absolute right-4 top-3.5 text-slate-400 hover:text-primary transition">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <p class="text-xs text-slate-400 mt-1">Ҳадди ақал 6 аломат.</p>
                                    </div>
                                    
                                    <div>
                                        <label for="confirm-password" class="block text-sm font-semibold text-slate-700 mb-2">Тасдиқи пароли нав</label>
                                        <div class="relative">
                                            <input type="password" id="confirm-password" class="custom-input w-full px-4 py-3 rounded-xl border border-slate-200 text-sm focus:outline-none" minlength="6" required>
                                            <button type="button" onclick="togglePassword('confirm-password', this)" class="absolute right-4 top-3.5 text-slate-400 hover:text-primary transition">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-4 border-t border-slate-100 flex justify-end">
                                        <button type="submit" id="password-save-btn" class="bg-dark hover:bg-slate-800 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition transform active:scale-95 flex items-center">
                                            <i class="fas fa-key mr-2"></i> Навсозӣ
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>


    <footer class="bg-white border-t border-slate-200 pt-12 pb-6 mt-auto">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div class="col-span-1 md:col-span-1">
                    <a href="https://istanbulfashiontj.github.io/istanbul-fashion-web/" class="flex items-center gap-2 mb-4">
                        <img src="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png" alt="Logo" class="h-10 object-contain">
                        <span class="font-bold text-xl">ISTANBUL<span class="text-primary">FASHION</span></span>
                    </a>
                    <p class="text-slate-500 text-sm leading-relaxed mb-4">
                        Мо беҳтарин либосҳоро мустақиман аз Туркия, Узбакистон ба Тоҷикистон меорем. Сифати олӣ ва нархҳои дастрас.
                    </p>
                    <div class="flex gap-3">
                        <a href="https://www.instagram.com/istanbulfashion.tj/" target="_blank" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-primary hover:text-white transition"><i class="fab fa-instagram"></i></a>
                        <a href="https://chat.whatsapp.com/IvuY0dM9dTAICyOAFsXg9r?mode=hqrc" target="_blank" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-primary hover:text-white transition"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" target="_blank" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-primary hover:text-white transition"><i class="fab fa-telegram-plane"></i></a>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-bold text-dark mb-4">Мағоза</h4>
                    <ul class="space-y-2 text-sm text-slate-500">
                        <li><a href="magazin.html" class="hover:text-primary transition">Мардона</a></li>
                        <li><a href="magazin.html" class="hover:text-primary transition">Навгониҳо</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold text-dark mb-4">Кӯмак</h4>
                    <ul class="space-y-2 text-sm text-slate-500">
                        <li><a href="tamos.html" class="hover:text-primary transition">Тамос бо мо</a></li>
                        <li><a href="tamos.html" class="hover:text-primary transition">Саволҳои зиёд такроршаванда</a></li>
                        <li><a href="tamos.html" class="hover:text-primary transition">Шартҳои хизматрасонӣ</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold text-dark mb-4">Тамос</h4>
                    <ul class="space-y-3 text-sm text-slate-500">
                        <li class="flex items-start gap-3">
                            <i class="fas fa-map-marker-alt text-primary mt-1"></i>
                            <span>ш.Душанбе, Б.Корвон, тарфаи Тилобозор, дарвозаи 4, қатори 3, аз тарафи дасти чап контейнер 3.</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-phone-alt text-primary"></i>
                            <span>+992 81-639-99-99</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-envelope text-primary"></i>
                            <span>info@istanbulwear.tj</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-slate-100 pt-6 text-center text-sm text-slate-400">
                <p>&copy; 2025 Istanbul Fashion Tj. Ҳамаи ҳуқуқҳо маҳфузанд.</p>
            </div>
        </div>
    </footer>

    
    <template id="order-card-template">
        <div class="order-card bg-white rounded-2xl p-5 sm:p-6 mb-4">
            <div class="flex flex-col sm:flex-row justify-between sm:items-center border-b border-slate-100 pb-4 mb-4 gap-2">
                <div>
                    <div class="flex items-center gap-3">
                        <h3 class="text-lg font-bold text-dark order-id-display">Фармоиш #...</h3>
                        <span class="order-status-badge text-[10px] uppercase tracking-wider font-bold px-2 py-1 rounded">Нав</span>
                    </div>
                    <p class="text-xs text-slate-500 mt-1 order-date-display">Сана: ...</p>
                </div>
                <div class="text-left sm:text-right">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Маблағи умумӣ</p>
                    <p class="text-xl font-extrabold text-primary order-total-display">0.00 с.</p>
                </div>
            </div>

            <div class="order-items-container space-y-3 mb-4">
               
            </div>

            <div class="flex justify-between items-center pt-2 mt-2">
                 <button class="order-toggle-btn text-sm font-semibold text-slate-500 hover:text-primary transition flex items-center gap-2">
                    <span>Тафсилот</span> <i class="fas fa-chevron-down text-xs transition-transform duration-300"></i>
                 </button>
            </div>
            
            <div class="order-details-expanded hidden mt-4 pt-4 border-t border-slate-100 bg-slate-50 rounded-xl p-4">
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                     <div>
                         <p class="text-xs text-slate-400 uppercase mb-1">Маълумоти тамос</p>
                         <p class="font-medium text-dark"><i class="fas fa-user mr-2 text-slate-400"></i> <span class="order-user-name">...</span></p>
                         <p class="font-medium text-dark mt-1"><i class="fas fa-phone mr-2 text-slate-400"></i> <span class="order-phone">...</span></p>
                     </div>
                     <div>
                         <p class="text-xs text-slate-400 uppercase mb-1">Нишонӣ</p>
                         <p class="font-medium text-dark"><i class="fas fa-map-marker-alt mr-2 text-slate-400"></i> <span class="order-address">...</span></p>
                     </div>
                     <div class="sm:col-span-2">
                         <p class="text-xs text-slate-400 uppercase mb-1">Маълумоти иловагӣ</p>
                         <p class="text-sm text-slate-600 bg-white p-2 rounded border border-slate-100 order-notes">Эзоҳ нест</p>
                         <p class="text-xs text-slate-400 mt-2">Коди тасдиқ: <span class="font-mono text-dark order-code">...</span></p>
                     </div>
                 </div>
            </div>
        </div>
    </template>

<script>
    
    function showNotification(message, type = 'success') {
        const notif = document.getElementById('app-notification');
        const title = document.getElementById('notif-title');
        const msg = document.getElementById('notif-message');
        const iconBox = notif.querySelector('.notif-icon-box');
        const icon = iconBox.querySelector('i');
        
        notif.className = ''; 
        if (type === 'success') {
            notif.classList.add('success');
            title.innerText = 'Муваффақона';
            icon.className = 'fas fa-check';
        } else if (type === 'error') {
            notif.classList.add('error');
            title.innerText = 'Диқат!';
            icon.className = 'fas fa-times';
        } else {
            notif.classList.add('info');
            title.innerText = 'Маълумот';
            icon.className = 'fas fa-info';
        }
        
        msg.innerText = message;
        notif.classList.add('show');
        setTimeout(() => notif.classList.remove('show'), 3500);
    }

    
    function switchTab(tabId) {
       
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));

       
        const content = document.getElementById(tabId);
        const btn = document.querySelector(`button[onclick="switchTab('${tabId}')"]`);
        
        if (content) content.classList.add('active');
        if (btn) btn.classList.add('active');

     
        if (tabId === 'orders') {
            loadOrders();
        }
    }

    
    const getToken = () => localStorage.getItem('userToken');

    function logout() {
        localStorage.removeItem('userToken');
        localStorage.removeItem('userName');
        localStorage.removeItem('userRole');
        localStorage.removeItem('userEmail');
        showNotification('Шумо аз система баромадед', 'info');
        
        setTimeout(() => window.location.href = 'https://istanbulfashiontj.github.io/istanbul-fashion-web/', 1000);
    }

    function togglePassword(id, btn) {
        const input = document.getElementById(id);
        const icon = btn.querySelector('i');
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    
    async function loadUserData() {
        const token = getToken();
        if (!token) {
            window.location.href = 'sabtinom.html';
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/api/user/profile`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (res.ok) {
                const data = await res.json();
                
               
                document.getElementById('user-name').innerText = data.name;
                document.getElementById('user-email').innerText = data.email;
                document.getElementById('user-initials').innerText = data.name.charAt(0).toUpperCase();
                
                
                document.getElementById('mobile-user-name').innerText = data.name;
                document.getElementById('mobile-user-email').innerText = data.email;
                document.getElementById('mobile-user-initials').innerText = data.name.charAt(0).toUpperCase();

                
                document.getElementById('profile-name').value = data.name;
                document.getElementById('profile-email').value = data.email;
                document.getElementById('profile-phone').value = data.phone || '';

                if (data.role === 'admin2006') {
                    document.getElementById('admin-link').classList.remove('hidden');
                    document.getElementById('admin-link').href = `${API_BASE}/admin`;
                }

                localStorage.setItem('userName', data.name);
            } else {
                logout();
            }
        } catch (e) {
            console.error(e);
            showNotification('Хатогӣ дар пайвастшавӣ бо сервер', 'error');
        }
    }

    
    async function loadOrders() {
        const token = getToken();
        if (!token) return;

        const listEl = document.getElementById('orders-list');
        const countEl = document.getElementById('orders-count');
        
        listEl.innerHTML = `
            <div class="text-center py-12">
                <i class="fas fa-circle-notch fa-spin text-primary text-3xl mb-4"></i>
                <p class="text-slate-500">Ҷустуҷӯи фармоишҳо...</p>
            </div>
        `;

        try {
            
            const res = await fetch(`${API_BASE}/api/user/orders`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (res.ok) {
                const orders = await res.json();
                countEl.innerText = orders.length;
                listEl.innerHTML = '';

                if (orders.length === 0) {
                    listEl.innerHTML = document.getElementById('no-orders-template').innerHTML;
                    document.querySelector('#orders-list > div').classList.remove('hidden');
                } else {
                    orders.forEach(order => renderOrderCard(order, listEl));
                }
            } else {
                listEl.innerHTML = '<p class="text-center text-red-500 py-4">Хатогӣ дар гирифтани маълумот</p>';
            }
        } catch (e) {
            console.error(e);
            listEl.innerHTML = '<p class="text-center text-red-500 py-4">Хатогӣ дар пайвастшавӣ</p>';
        }
    }

    function renderOrderCard(order, container) {
        const template = document.getElementById('order-card-template');
        const clone = template.content.cloneNode(true);
        const card = clone.querySelector('.order-card');

        
        const statusMap = {
            'Нав': { class: 'bg-blue-100 text-blue-700', text: 'Нав' },
            'New': { class: 'bg-blue-100 text-blue-700', text: 'Нав' },
            'Processing': { class: 'bg-yellow-100 text-yellow-700', text: 'Дар ҳоли иҷро' },
            'Shipped': { class: 'bg-purple-100 text-purple-700', text: 'Фиристода шуд' },
            'Delivered': { class: 'bg-green-100 text-green-700', text: 'Дастрас шуд' },
            'Cancelled': { class: 'bg-red-100 text-red-700', text: 'Бекор шуд' }
        };
        const statusKey = order.status || 'New';
        const statusInfo = statusMap[statusKey] || { class: 'bg-slate-100 text-slate-700', text: statusKey };

        
        card.querySelector('.order-id-display').innerText = order.order_id || `ORD${order.id}`;
        card.querySelector('.order-date-display').innerText = order.created_full || order.created_date || new Date().toLocaleDateString();
        
        const badge = card.querySelector('.order-status-badge');
        badge.className = `order-status-badge text-[10px] uppercase tracking-wider font-bold px-2 py-1 rounded ${statusInfo.class}`;
        badge.innerText = statusInfo.text;

        card.querySelector('.order-total-display').innerText = order.total_formatted || `${order.total || 0} TJS`;

       
        card.querySelector('.order-user-name').innerText = order.user_name || '...';
        card.querySelector('.order-phone').innerText = order.phone || '...';
        card.querySelector('.order-address').innerText = order.address || '...';
        card.querySelector('.order-code').innerText = order.confirmation_code || '---';
        card.querySelector('.order-notes').innerText = order.notes || 'Эзоҳ нест';

        
        const itemsContainer = card.querySelector('.order-items-container');
        let items = order.cart_items;
        
        
        if (typeof items === 'string') {
            try { items = JSON.parse(items); } catch(e) { items = []; }
        }
        if (!Array.isArray(items)) items = [];

        if (items.length > 0) {
            items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex items-center justify-between text-sm py-1';
                
                
                let imgSrc = item.product_image || item.image || item.image_url;
                if (!imgSrc && item.image_path) imgSrc = `${API_BASE}/static/uploads/${item.image_path}`;
                
               
                if (!imgSrc) {
                    imgSrc = 'https://placehold.co/100?text=IMG'; 
                } else if (!imgSrc.startsWith('http')) {
                    
                    imgSrc = imgSrc.startsWith('/') ? `${API_BASE}${imgSrc}` : `${API_BASE}/${imgSrc}`;
                }

                itemEl.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-slate-100 rounded-lg overflow-hidden flex-shrink-0">
                            <img src="${imgSrc}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/100?text=Error'">
                        </div>
                        <div>
                            <p class="font-bold text-dark line-clamp-1">${item.name || item.product_name || item.name_tj || 'Маҳсулот'}</p>
                            <p class="text-xs text-slate-500">Андоза: ${item.selectedSize || item.size || '-'} | Миқдор: ${item.quantity}</p>
                        </div>
                    </div>
                    <p class="font-bold text-slate-700">${item.price} с.</p>
                `;
                itemsContainer.appendChild(itemEl);
            });
        } else {
            itemsContainer.innerHTML = '<p class="text-sm text-slate-400 italic">Рӯйхати маҳсулот дастрас нест</p>';
        }

        
        const toggleBtn = card.querySelector('.order-toggle-btn');
        const details = card.querySelector('.order-details-expanded');
        const icon = toggleBtn.querySelector('i');

        toggleBtn.addEventListener('click', () => {
            details.classList.toggle('hidden');
            if (details.classList.contains('hidden')) {
                toggleBtn.querySelector('span').innerText = 'Тафсилот';
                icon.style.transform = 'rotate(0deg)';
            } else {
                toggleBtn.querySelector('span').innerText = 'Пинҳон кардан';
                icon.style.transform = 'rotate(180deg)';
            }
        });

        container.appendChild(card);
    }

    
    document.getElementById('profile-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const token = getToken();
        const btn = document.getElementById('profile-save-btn');
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ...';
        btn.disabled = true;

        const name = document.getElementById('profile-name').value;
        const phone = document.getElementById('profile-phone').value;

        try {
            const res = await fetch(`${API_BASE}/api/user/profile`, {
                method: 'PUT',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` 
                },
                body: JSON.stringify({ name, phone })
            });

            if (res.ok) {
                showNotification('Маълумот сабт шуд');
                loadUserData();
            } else {
                showNotification('Хатогӣ дар сабт', 'error');
            }
        } catch (e) {
            showNotification('Хатогӣ дар пайвастшавӣ', 'error');
        } finally {
            btn.innerHTML = originalContent;
            btn.disabled = false;
        }
    });

    
    document.getElementById('password-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const token = getToken();
        const oldPass = document.getElementById('old-password').value;
        const newPass = document.getElementById('new-password').value;
        const confPass = document.getElementById('confirm-password').value;

        if (newPass !== confPass) {
            showNotification('Паролҳо мувофиқат намекунанд', 'error');
            return;
        }

        const btn = document.getElementById('password-save-btn');
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ...';
        btn.disabled = true;

        try {
            const res = await fetch(`${API_BASE}/api/user/change-password`, {
                method: 'PUT',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` 
                },
                body: JSON.stringify({ old_password: oldPass, new_password: newPass })
            });
            
            const data = await res.json();

            if (res.ok) {
                showNotification('Парол иваз карда шуд');
                e.target.reset();
            } else {
                showNotification(data.error || 'Хатогӣ', 'error');
            }
        } catch (e) {
            showNotification('Хатогӣ дар пайвастшавӣ', 'error');
        } finally {
            btn.innerHTML = originalContent;
            btn.disabled = false;
        }
    });

    
    document.addEventListener('DOMContentLoaded', () => {
        loadUserData();
        
        
        const toggleMenu = () => {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-menu-overlay');
            const isOpen = menu.classList.contains('open');
            
            if(isOpen) {
                menu.classList.remove('open');
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            } else {
                menu.classList.add('open');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        };
        
        document.getElementById('mobile-menu-btn').addEventListener('click', toggleMenu);
        document.getElementById('close-menu-btn').addEventListener('click', toggleMenu);
        document.getElementById('mobile-menu-overlay').addEventListener('click', toggleMenu);

        
        if (document.getElementById('orders').classList.contains('active')) {
            loadOrders();
        }
    });
</script>
</body>
</html>
