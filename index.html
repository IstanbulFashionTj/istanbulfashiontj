<!DOCTYPE html>
<html lang="tg" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="google-site-verification" content="IwD6d5oSelRMyJZ3CbrA1e7Ydo7TTmKIGZen79PO1wA" />

    <title>Istanbul Fashion TJ ‚Äî –õ–∏–±–æ—Å“≥–æ–∏ –¢—É—Ä–∫”£ –≤–∞ –£–∑–±–µ–∫”£ –¥–∞—Ä –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω</title>

    <meta name="description"
          content="Istanbul Fashion TJ ‚Äî –º–∞“ì–æ–∑–∞–∏ —Ä–∞—Å–º–∏–∏ –ª–∏–±–æ—Å“≥–æ–∏ –¢—É—Ä–∫”£ –≤–∞ –£–∑–±–µ–∫”£ –¥–∞—Ä –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω. –°–∏—Ñ–∞—Ç–∏ –æ–ª”£, –Ω–∞—Ä—Ö–∏ –¥–∞—Å—Ç—Ä–∞—Å, —Ñ–∞—Ä–º–æ–∏—à –æ–Ω–ª–∞–π–Ω." />

    <meta name="keywords"
          content="Istanbul Fashion TJ, –ª–∏–±–æ—Å“≥–æ–∏ —Ç—É—Ä–∫”£ –î—É—à–∞–Ω–±–µ, –ª–∏–±–æ—Å“≥–æ–∏ —É–∑–±–µ–∫”£, –º–∞“ì–æ–∑–∞–∏ –ª–∏–±–æ—Å –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω, —Ö–∞—Ä–∏–¥–∏ –æ–Ω–ª–∞–π–Ω" />

    <meta name="author" content="Istanbul Fashion TJ">

  
    <link rel="canonical" href="https://istanbulfashiontj.github.io/istanbulfashiontj/" />

    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Istanbul Fashion TJ">
    <meta property="og:title" content="Istanbul Fashion TJ ‚Äî –õ–∏–±–æ—Å“≥–æ–∏ –¢—É—Ä–∫”£ –≤–∞ –£–∑–±–µ–∫”£">
    <meta property="og:description" content="–ú–∞“ì–æ–∑–∞–∏ —Ä–∞—Å–º–∏–∏ –ª–∏–±–æ—Å“≥–æ–∏ –¢—É—Ä–∫”£ –≤–∞ –£–∑–±–µ–∫”£ –¥–∞—Ä –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω.">
    <meta property="og:url" content="https://istanbulfashiontj.github.io/istanbulfashiontj/">
    <meta property="og:image" content="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Istanbul Fashion TJ">
    <meta name="twitter:description" content="–õ–∏–±–æ—Å“≥–æ–∏ –º—É–æ—Å–∏—Ä–∏ –¢—É—Ä–∫”£ –≤–∞ –£–∑–±–µ–∫”£ –¥–∞—Ä –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω.">
    <meta name="twitter:image" content="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ClothingStore",
      "name": "Istanbul Fashion TJ",
      "url": "https://istanbulfashiontj.github.io/istanbulfashiontj/",
      "logo": "https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png",
      "sameAs": [
        "https://www.instagram.com/istanbulfashion.tj/"
      ],
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Dushanbe",
        "addressCountry": "TJ"
      }
    }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <link rel="icon" type="image/png"
          href="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png" />

    <script>
        const API_BASE = 'https://istanbulfashiontj.pythonanywhere.com';

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5FBF', 
                        'primary-dark': '#6D28D9',
                        accent: '#F59E0B', 
                        'accent-dark': '#D97706',
                        dark: '#0F172A',
                        light: '#F8FAFC',
                        surface: '#FFFFFF',
                        'chat-bg': '#F0F2F5',
                        'chat-user': '#8B5FBF',
                        'chat-bot': '#FFFFFF'
                    },
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                        'glow': '0 0 20px rgba(139, 95, 191, 0.3)',
                        'chat': '0 5px 30px rgba(0,0,0,0.15)'
                    },
                    animation: {
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'scale-in': 'scaleIn 0.2s ease-out forwards',
                        'fade-in': 'fadeIn 0.3s ease-out forwards'
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        fadeIn: {
                            'from': { opacity: '0' },
                            'to': { opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Manrope', sans-serif; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #c7d2fe; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #8B5FBF; }
        .glass-nav { background: rgba(255,255,255,.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,.3); }
        .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

        .product-card { transition: all 0.3s ease; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .product-image-container { position: relative; overflow: hidden; border-radius: 16px; }
        .product-image-container img { transition: transform 0.5s ease; }
        .product-card:hover .product-image-container img { transform: scale(1.05); }
        
        .action-overlay { position: absolute; inset: 0; background: rgba(0, 0, 0, 0.2); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; }
        .product-card:hover .action-overlay { opacity: 1; }
        
        @media (max-width: 640px) {
            .action-overlay { background: transparent; opacity: 1; align-items: flex-end; justify-content: flex-end; padding: 10px; pointer-events: none; }
            .action-btn-mobile { pointer-events: auto; background: white; color: #8B5FBF; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        }

        #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.6s ease-out, visibility 0.6s ease-out; }
        .video-wrapper { width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; }
        .video-wrapper video { width: 100%; height: 100%; object-fit: contain; }
        
        .mobile-menu { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        .mobile-menu.open { transform: translateX(0); }
        
        .category-card { position: relative; overflow: hidden; border-radius: 16px; }
        .category-overlay { background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 60%, transparent 100%); }

        #app-notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); z-index: 9999; width: 90%; max-width: 400px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding: 12px 16px; border-radius: 16px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 12px; border: 1px solid rgba(255, 255, 255, 0.5); transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); opacity: 0; pointer-events: none; }
        #app-notification.show { transform: translateX(-50%) translateY(0); opacity: 1; pointer-events: auto; }
        #app-notification.success { border-left: 4px solid #10B981; }
        #app-notification.error { border-left: 4px solid #EF4444; }
        .notif-icon-box { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .success .notif-icon-box { background: #D1FAE5; color: #10B981; }
        .error .notif-icon-box { background: #FEE2E2; color: #EF4444; }
        
        .chat-bubble-user { border-radius: 18px 18px 2px 18px; box-shadow: 0 2px 5px rgba(139, 95, 191, 0.2); }
        .chat-bubble-bot { border-radius: 18px 18px 18px 2px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>

<body class="bg-light text-slate-800">

    <h1 class="sr-only">Istanbul Fashion TJ ‚Äî –ú–∞“ì–æ–∑–∞–∏ –ª–∏–±–æ—Å“≥–æ–∏ –¢—É—Ä–∫”£ –≤–∞ –£–∑–±–µ–∫”£ –¥–∞—Ä –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω</h1>

    <div id="preloader">
        <div class="video-wrapper">
            <video autoplay loop muted playsinline>
                <source src="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.mp4" type="video/mp4">
                <img src="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png" alt="Loading..." class="w-full h-full object-contain">
            </video>
        </div>
    </div>

    <div id="app-notification">
        <div class="notif-icon-box">
            <i class="fas fa-check"></i>
        </div>
        <div class="flex-1 min-w-0">
            <p class="text-sm font-bold text-slate-800" id="notif-title">Success</p>
            <p class="text-xs text-slate-500 truncate" id="notif-message">Message goes here</p>
        </div>
    </div>

    <header class="fixed w-full top-0 z-50 glass-nav transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="flex justify-between items-center h-16 sm:h-20">
                <button id="mobile-menu-btn" class="lg:hidden text-2xl text-dark hover:text-primary transition">
                    <i class="fas fa-bars"></i>
                </button>

                <a href="index.html" class="flex items-center gap-2 group">
                    <img src="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png" alt="Istanbul Wear" class="h-10 w-10 sm:h-12 sm:w-12 object-contain group-hover:scale-110 transition-transform">
                    <div class="hidden sm:block">
                        <h1 class="text-xl font-bold leading-none tracking-tight">ISTANBUL<span class="text-primary">FASHION TJ</span></h1>
                        <p class="text-[10px] text-slate-500 font-medium tracking-widest uppercase">Style from Turkey and Uzbekistan</p>
                    </div>
                </a>

                <nav class="hidden lg:flex items-center space-x-8">
                    <a href="index.html" class="text-sm font-semibold text-primary">–ê—Å–æ—Å”£</a>
                    <a href="magazin.html" class="text-sm font-semibold text-slate-600 hover:text-primary transition">–ú–∞“ì–æ–∑–∞</a>
                    <div class="relative group">
                        <button class="text-sm font-semibold text-slate-600 hover:text-primary transition flex items-center gap-1">
                            –ö–∞—Ç–µ–≥–æ—Ä–∏—è“≥–æ <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div class="absolute top-full left-0 w-48 bg-white shadow-soft rounded-xl p-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all transform translate-y-2 group-hover:translate-y-0 duration-200">
                            <div id="desktop-categories-dropdown" class="flex flex-col">
                                <span class="text-xs text-slate-400 p-2">–ë–æ—Ä–≥–∏—Ä”£...</span>
                            </div>
                        </div>
                    </div>
                    <a href="tamos.html" class="text-sm font-semibold text-slate-600 hover:text-primary transition">–¢–∞–º–æ—Å</a>
                </nav>

                <div class="flex items-center gap-2 sm:gap-4">
                    <div class="hidden md:block relative group">
                        <input type="text" id="desktop-search-input" placeholder="“∂—É—Å—Ç—É“∑”Ø..." class="bg-slate-100 border-none rounded-full py-2 px-4 pl-10 text-sm focus:ring-2 focus:ring-primary w-40 focus:w-64 transition-all duration-300 outline-none">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    </div>

                    <a href="wishlist.html" class="relative p-2 text-slate-700 hover:text-primary transition">
                        <i class="far fa-heart text-xl"></i>
                        <span id="wishlist-count" class="absolute top-0 right-0 h-4 w-4 bg-accent text-[10px] font-bold text-white rounded-full flex items-center justify-center scale-0 transition-transform duration-300">0</span>
                    </a>
                    
                    <a href="sabad.html" class="relative p-2 text-slate-700 hover:text-primary transition">
                        <i class="fas fa-shopping-bag text-xl"></i>
                        <span id="cart-count" class="absolute top-0 right-0 h-4 w-4 bg-primary text-[10px] font-bold text-white rounded-full flex items-center justify-center scale-0 transition-transform duration-300">0</span>
                    </a>

                    <div id="user-section" class="relative ml-1">
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden backdrop-blur-sm transition-opacity"></div>
    
    <div id="mobile-menu" class="mobile-menu fixed top-0 left-0 h-full w-[80%] max-w-sm bg-white z-50 shadow-2xl overflow-y-auto">
        <div class="p-5">
            <div class="flex justify-between items-center mb-8">
                <span class="font-bold text-xl">–ú–µ–Ω—é</span>
                <button id="close-menu-btn" class="text-slate-500 hover:text-danger p-2"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div id="mobile-user-card" class="bg-slate-50 rounded-2xl p-4 mb-6 flex items-center gap-3 border border-slate-100">
                <div class="w-10 h-10 rounded-full bg-slate-200 animate-pulse"></div>
                <div class="flex-1 space-y-2">
                    <div class="h-4 bg-slate-200 rounded w-2/3 animate-pulse"></div>
                </div>
            </div>

            <div class="mb-6 relative">
                 <input type="text" id="mobile-search-input" placeholder="“∂—É—Å—Ç—É“∑”Ø–∏ –º–∞“≥—Å—É–ª–æ—Ç..." class="w-full bg-slate-100 border-none rounded-xl py-3 px-4 pl-10 text-sm focus:ring-2 focus:ring-primary outline-none">
                 <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
            </div>

            <nav class="space-y-1">
                <a href="index.html" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-primary/10 text-primary font-medium">
                    <i class="fas fa-home w-5"></i> –ê—Å–æ—Å”£
                </a>
                <a href="magazin.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-medium transition">
                    <i class="fas fa-store w-5"></i> –ú–∞“ì–æ–∑–∞
                </a>
                
                <div class="py-2">
                    <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è“≥–æ</p>
                    <div id="mobile-categories-list" class="space-y-1 pl-2">
                        
                    </div>
                </div>

                <a href="tamos.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-medium transition">
                    <i class="fas fa-headset w-5"></i> –¢–∞–º–æ—Å
                </a>
            </nav>
        </div>
    </div>

    <main class="pt-16 sm:pt-20">
        <section class="relative group">
            <div class="swiper hero-swiper h-[60vh] sm:h-[75vh] min-h-[500px]">
                <div class="swiper-wrapper" id="hero-wrapper">
                    <div class="swiper-slide bg-slate-200 flex items-center justify-center">
                        <div class="animate-pulse flex flex-col items-center">
                            <div class="h-8 w-64 bg-slate-300 rounded mb-4"></div>
                            <div class="h-4 w-48 bg-slate-300 rounded"></div>
                        </div>
                    </div>
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next hidden sm:flex text-white hover:text-primary transition"></div>
                <div class="swiper-button-prev hidden sm:flex text-white hover:text-primary transition"></div>
            </div>
        </section>

        <section class="py-10 bg-white border-b border-slate-100">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 sm:gap-8">
                    <div class="flex flex-col items-center text-center gap-2 p-4 rounded-2xl hover:bg-slate-50 transition">
                        <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary mb-1">
                            <i class="fas fa-truck text-xl"></i>
                        </div>
                        <h3 class="font-bold text-sm sm:text-base">–†–∞—Å–æ–Ω–∏–¥–∞–Ω</h3>
                        <p class="text-xs text-slate-500">–°—É—Ä—ä–∞—Ç –≤–∞ —Å–∏—Ñ–∞—Ç</p>
                    </div>
                    <div class="flex flex-col items-center text-center gap-2 p-4 rounded-2xl hover:bg-slate-50 transition">
                        <div class="w-12 h-12 rounded-full bg-accent/10 flex items-center justify-center text-accent mb-1">
                            <i class="fas fa-medal text-xl"></i>
                        </div>
                        <h3 class="font-bold text-sm sm:text-base">–°–∏—Ñ–∞—Ç–∏ –ê—Å–ª”£</h3>
                        <p class="text-xs text-slate-500">–ò—Å—Ç–µ“≥—Å–æ–ª–∏ –¢—É—Ä–∫–∏—è</p>
                    </div>
                    <div class="flex flex-col items-center text-center gap-2 p-4 rounded-2xl hover:bg-slate-50 transition">
                        <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-green-600 mb-1">
                            <i class="fas fa-undo text-xl"></i>
                        </div>
                        <h3 class="font-bold text-sm sm:text-base">–ë–æ–∑–≥–∞—à—Ç</h3>
                        <p class="text-xs text-slate-500">–ö–∞—Ñ–æ–ª–∞—Ç–∏ –∏–≤–∞–∑</p>
                    </div>
                    <div class="flex flex-col items-center text-center gap-2 p-4 rounded-2xl hover:bg-slate-50 transition">
                        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mb-1">
                            <i class="fas fa-headset text-xl"></i>
                        </div>
                        <h3 class="font-bold text-sm sm:text-base">–î–∞—Å—Ç–≥–∏—Ä”£</h3>
                        <p class="text-xs text-slate-500">“≤–∞—Ä —Ä”Ø–∑ 24/7</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h2 class="text-2xl sm:text-3xl font-extrabold text-dark">–ö–∞—Ç–µ–≥–æ—Ä–∏—è“≥–æ</h2>
                        <p class="text-slate-500 mt-1">–ò–Ω—Ç–∏—Ö–æ–±–∏ –≤–∞—Å–µ—ä –±–∞—Ä–æ–∏ “≥–∞–º–∞</p>
                    </div>
                    <a href="magazin.html" class="hidden sm:flex items-center text-primary font-semibold hover:gap-2 transition-all">
                        “≤–∞–º–∞–∞—à—Ä–æ –¥–∏–¥–∞–Ω <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
                
                <div id="categories-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
                    
                </div>
                
                <div class="mt-6 sm:hidden text-center">
                    <a href="magazin.html" class="btn-primary inline-flex items-center justify-center w-full py-3 rounded-xl bg-slate-100 text-slate-700 font-semibold">
                        “≤–∞–º–∞–∞—à—Ä–æ –¥–∏–¥–∞–Ω
                    </a>
                </div>
            </div>
        </section>

        <section class="py-16 bg-slate-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-10">
                    <span class="text-accent font-bold tracking-wider text-xs uppercase mb-2 block">–ö–æ–ª–ª–µ–∫—Å–∏—è–∏ –Ω–∞–≤</span>
                    <h2 class="text-3xl sm:text-4xl font-extrabold text-dark mb-4">–ù–∞–≤–≥–æ–Ω–∏“≥–æ</h2>
                    <div class="w-20 h-1 bg-primary mx-auto rounded-full"></div>
                </div>

                <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-8">
                    <div class="product-card bg-white rounded-2xl p-3 shadow-sm">
                        <div class="aspect-[3/4] bg-slate-200 rounded-xl mb-4 animate-pulse"></div>
                    </div>
                </div>

                <div class="text-center mt-12">
                    <a href="magazin.html" class="inline-block px-8 py-3 bg-primary text-white font-bold rounded-full shadow-lg shadow-primary/30 hover:-translate-y-1 transition transform">
                        –ë–∞ –ú–∞“ì–æ–∑–∞ –ì—É–∑–∞—à—Ç–∞–Ω
                    </a>
                </div>
            </div>
        </section>

        <section class="py-20 relative overflow-hidden">
            <div class="absolute inset-0 bg-dark">
                <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80" class="w-full h-full object-cover opacity-20" alt="Background">
            </div>
            <div class="container mx-auto px-4 relative z-10 text-center">
                <h2 class="text-3xl sm:text-4xl font-extrabold text-white mb-4">–ê–∑ –Ω–∞–≤–≥–æ–Ω–∏“≥–æ –±–æ—Ö–∞–±–∞—Ä —à–∞–≤–µ–¥!</h2>
                <p class="text-slate-300 mb-8 max-w-xl mx-auto">–ë–∞ –±—é–ª–ª–µ—Ç–µ–Ω–∏ –º–æ –æ–±—É–Ω–∞ —à–∞–≤–µ–¥ –≤–∞ 10% —Ç–∞—Ö—Ñ–∏—Ñ –±–∞—Ä–æ–∏ —Ö–∞—Ä–∏–¥–∏ –∞–≤–≤–∞–ª–∏–Ω –±–∞ –¥–∞—Å—Ç –æ—Ä–µ–¥.</p>
                
                <form id="subscribe-form" class="max-w-md mx-auto flex flex-col sm:flex-row gap-2">
                    <input type="email" id="sub-email" placeholder="–ü–æ—á—Ç–∞–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∏ —à—É–º–æ" class="flex-1 px-5 py-3 rounded-full bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:bg-white/20 backdrop-blur-sm transition" required>
                    <button type="submit" class="px-8 py-3 bg-accent hover:bg-accent-dark text-white font-bold rounded-full transition shadow-lg shadow-accent/20">–û–±—É–Ω–∞</button>
                </form>
                <p id="sub-message" class="text-sm mt-3 h-5"></p>
            </div>
        </section>
    </main>

    <footer class="bg-white border-t border-slate-200 pt-12 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div class="col-span-1 md:col-span-1">
                    <a href="index.html" class="flex items-center gap-2 mb-4">
                        <img src="https://istanbulfashiontj.pythonanywhere.com/static/uploads/logo.png" alt="Logo" class="h-10 object-contain">
                        <span class="font-bold text-xl">ISTANBUL<span class="text-primary">FASHION</span></span>
                    </a>
                    <p class="text-slate-500 text-sm leading-relaxed mb-4">
                        –ú–æ –±–µ“≥—Ç–∞—Ä–∏–Ω –ª–∏–±–æ—Å“≥–æ—Ä–æ –º—É—Å—Ç–∞“õ–∏–º–∞–Ω –∞–∑ –¢—É—Ä–∫–∏—è, –£–∑–±–∞–∫–∏—Å—Ç–æ–Ω –±–∞ –¢–æ“∑–∏–∫–∏—Å—Ç–æ–Ω –º–µ–æ—Ä–µ–º. –°–∏—Ñ–∞—Ç–∏ –æ–ª”£ –≤–∞ –Ω–∞—Ä—Ö“≥–æ–∏ –¥–∞—Å—Ç—Ä–∞—Å.
                    </p>
                    <div class="flex gap-3">
                        <a href="https://www.instagram.com/istanbulfashion.tj/" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-primary hover:text-white transition"><i class="fab fa-instagram"></i></a>
                        <a href="https://chat.whatsapp.com/IvuY0dM9dTAICyOAFsXg9r?mode=hqrc" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-primary hover:text-white transition"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-primary hover:text-white transition"><i class="fab fa-telegram-plane"></i></a>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-bold text-dark mb-4">–ú–∞“ì–æ–∑–∞</h4>
                    <ul class="space-y-2 text-sm text-slate-500">
                        <li><a href="magazin.html" class="hover:text-primary transition">–ú–∞—Ä–¥–æ–Ω–∞</a></li>
                        <li><a href="magazin.html" class="hover:text-primary transition">–ó–∞–Ω–æ–Ω–∞</a></li>
                        <li><a href="magazin.html" class="hover:text-primary transition">–ö”Ø–¥–∞–∫–æ–Ω–∞</a></li>
                        <li><a href="magazin.html" class="hover:text-primary transition">–ù–∞–≤–≥–æ–Ω–∏“≥–æ</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold text-dark mb-4">–ö”Ø–º–∞–∫</h4>
                    <ul class="space-y-2 text-sm text-slate-500">
                        <li><a href="tamos.html" class="hover:text-primary transition">–¢–∞–º–æ—Å –±–æ –º–æ</a></li>
                        <li><a href="tamos.html" class="hover:text-primary transition">–°–∞–≤–æ–ª“≥–æ–∏ –∑–∏—ë–¥ —Ç–∞–∫—Ä–æ—Ä—à–∞–≤–∞–Ω–¥–∞</a></li>
                        <li><a href="tamos.html" class="hover:text-primary transition">–®–∞—Ä—Ç“≥–æ–∏ —Ö–∏–∑–º–∞—Ç—Ä–∞—Å–æ–Ω”£</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold text-dark mb-4">–¢–∞–º–æ—Å</h4>
                    <ul class="space-y-3 text-sm text-slate-500">
                        <li class="flex items-start gap-3">
                            <i class="fas fa-map-marker-alt text-primary mt-1"></i>
                            <span>—à.–î—É—à–∞–Ω–±–µ, –ë.–ö–æ—Ä–≤–æ–Ω, —Ç–∞—Ä—Ñ–∞–∏ –¢–∏–ª–æ–±–æ–∑–æ—Ä, –¥–∞—Ä–≤–æ–∑–∞–∏ 4, “õ–∞—Ç–æ—Ä–∏ 3, –∞–∑ —Ç–∞—Ä–∞—Ñ–∏ –¥–∞—Å—Ç–∏ —á–∞–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 3.</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-phone-alt text-primary"></i>
                            <span>+992 81-639-99-99</span>
                        </li>
                        <li class="flex items-center gap-3">
                            <i class="fas fa-envelope text-primary"></i>
                            <span>info@istanbulwear.tj</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-slate-100 pt-6 text-center text-sm text-slate-400">
                <p>&copy; 2025 Istanbul Fashion Tj. “≤–∞–º–∞–∏ “≥—É“õ—É“õ“≥–æ –º–∞“≥—Ñ—É–∑–∞–Ω–¥.</p>
            </div>
        </div>
    </footer>

    <div id="ai-chat-widget" class="fixed bottom-6 right-6 z-[100] font-sans">
        
        <button id="chat-toggle-btn" class="w-14 h-14 md:w-16 md:h-16 bg-primary text-white rounded-full shadow-glow flex items-center justify-center text-2xl hover:scale-105 active:scale-95 transition-all duration-300 relative overflow-hidden group z-[101]">
            <div class="absolute inset-0 bg-white/20 rounded-full scale-0 group-hover:scale-100 transition-transform duration-300"></div>
            <span class="absolute top-3 right-3 w-3 h-3 bg-red-500 border-2 border-primary rounded-full animate-pulse"></span>
            <i class="fas fa-comment-dots relative z-10 transition-transform duration-300"></i>
        </button>

        <div id="chat-window" class="fixed inset-0 md:inset-auto md:bottom-24 md:right-6 w-full h-full md:w-[380px] md:h-[600px] md:max-h-[80vh] bg-surface md:rounded-3xl shadow-2xl flex flex-col overflow-hidden transition-all duration-300 invisible opacity-0 translate-y-4 z-[110]">
            
            <div class="bg-primary p-4 pb-6 flex justify-between items-start text-white shrink-0 relative overflow-hidden">
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-white/10 rounded-full blur-xl"></div>
                <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-white/10 rounded-full blur-xl"></div>
                
                <div class="flex items-center gap-3 relative z-10">
                    <div class="w-11 h-11 rounded-full bg-white/20 p-0.5 backdrop-blur-sm border border-white/30">
                         <div class="w-full h-full rounded-full bg-white flex items-center justify-center overflow-hidden">
                             <img src="https://cdn-icons-png.flaticon.com/512/4712/4712027.png" alt="Bot" class="w-8 h-8 object-contain">
                         </div>
                    </div>
                    <div>
                        <h3 class="font-extrabold text-lg leading-tight tracking-wide">Istanbul AI</h3>
                        <div class="flex items-center gap-1.5 opacity-90">
                            <span class="w-2 h-2 rounded-full bg-green-400 shadow-[0_0_8px_rgba(74,222,128,0.8)] animate-pulse"></span>
                            <p class="text-xs font-medium text-white/90">–û–Ω–ª–∞–π–Ω</p>
                        </div>
                    </div>
                </div>
                
                <button id="close-chat" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20 transition text-white/80 hover:text-white relative z-10">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div id="chat-messages" class="flex-1 bg-[#F0F2F5] p-4 overflow-y-auto space-y-4 scroll-smooth pb-safe">
                <div class="flex justify-center my-2">
                    <span class="text-[10px] bg-slate-200 text-slate-500 px-2 py-1 rounded-full font-medium">–ò–º—Ä”Ø–∑</span>
                </div>

                <div class="flex items-end gap-2 max-w-[85%] animate-fade-in">
                     <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-primary text-xs shrink-0 shadow-sm border border-slate-100">
                        <i class="fas fa-robot"></i>
                     </div>
                     <div class="bg-white p-3.5 chat-bubble-bot text-sm text-slate-700 leading-relaxed shadow-[0_2px_5px_rgba(0,0,0,0.02)]">
                        –°–∞–ª–æ–º! üëã <br>
                        –ú–∞–Ω —ë—Ä–¥–∞–º—á–∏–∏ “≥—É—à–º–∞–Ω–¥–∏ <b>Istanbul Fashion</b>.
                        <br><br>
                        –®—É–º–æ –º–µ—Ç–∞–≤–æ–Ω–µ–¥ –¥–∞—Ä –±–æ—Ä–∞–∏ –Ω–∞—Ä—Ö“≥–æ, –∞–Ω–¥–æ–∑–∞“≥–æ –≤–∞ –∏–Ω—Ç–∏“õ–æ–ª –ø—É—Ä—Å–µ–¥.
                     </div>
                </div>
                
                <div class="flex flex-wrap gap-2 pl-10 animate-fade-in delay-100">
                    <button class="suggestion-btn px-3 py-1.5 bg-white border border-slate-200 rounded-full text-xs text-slate-600 hover:bg-primary hover:text-white transition shadow-sm">–ù–∞—Ä—Ö“≥–æ</button>
                    <button class="suggestion-btn px-3 py-1.5 bg-white border border-slate-200 rounded-full text-xs text-slate-600 hover:bg-primary hover:text-white transition shadow-sm">–ò–Ω—Ç–∏“õ–æ–ª</button>
                    <button class="suggestion-btn px-3 py-1.5 bg-white border border-slate-200 rounded-full text-xs text-slate-600 hover:bg-primary hover:text-white transition shadow-sm">–ê–Ω–¥–æ–∑–∞“≥–æ</button>
                </div>
            </div>

            <div class="p-3 bg-white border-t border-slate-100 shrink-0 pb-safe z-20 shadow-[0_-5px_20px_rgba(0,0,0,0.03)]">
                <form id="chat-form" class="relative flex items-end gap-2" onsubmit="return false;">
                    <div class="relative flex-1 bg-slate-100 rounded-2xl transition-all focus-within:ring-2 focus-within:ring-primary/20 focus-within:bg-white border border-transparent focus-within:border-primary/30">
                        <textarea id="chat-input" rows="1" class="w-full bg-transparent border-none px-4 py-3 text-sm focus:ring-0 resize-none max-h-24 outline-none placeholder:text-slate-400 text-slate-700" placeholder="–°–∞–≤–æ–ª–∏ —Ö—É–¥—Ä–æ –Ω–∞–≤–∏—Å–µ–¥..." autocomplete="off"></textarea>
                    </div>
                    <!-- TYPE=BUTTON IS CRITICAL HERE -->
                    <button type="button" id="chat-submit-btn" class="w-11 h-11 bg-primary text-white rounded-full flex items-center justify-center hover:bg-primary-dark transition shadow-lg shadow-primary/20 disabled:opacity-50 disabled:cursor-not-allowed group shrink-0 mb-0.5">
                        <i class="fas fa-paper-plane text-sm translate-x-[-1px] translate-y-[1px] group-hover:scale-110 transition-transform"></i>
                    </button>
                </form>
                <div class="text-center mt-2">
                    <p class="text-[10px] text-slate-400">Powered by Istanbul AI</p>
                </div>
            </div>
        </div>
        
        <div id="chat-backdrop" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-[105] hidden opacity-0 transition-opacity duration-300 md:hidden"></div>
    </div>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        window.API_BASE = 'https://istanbulfashiontj.pythonanywhere.com';
        
        function showNotification(message, type = 'success') {
            const notif = document.getElementById('app-notification');
            const title = document.getElementById('notif-title');
            const msg = document.getElementById('notif-message');
            const iconBox = notif.querySelector('.notif-icon-box');
            const icon = iconBox.querySelector('i');
            
            notif.className = ''; 
            if (type === 'success') {
                notif.classList.add('success');
                title.innerText = '–ú—É–≤–∞—Ñ—Ñ–∞“õ–æ–Ω–∞!';
                icon.className = 'fas fa-check';
            } else {
                notif.classList.add('error');
                title.innerText = '–û–≥–æ“≥”£!';
                icon.className = 'fas fa-exclamation';
            }
            
            msg.innerText = message;
            notif.classList.add('show');
            
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        function getImageUrl(path) {
            if (!path) return '';
            if (path.startsWith('http') || path.startsWith('https')) return path;
            if (path.startsWith('/static/uploads/')) return window.API_BASE + path;
            if (path.includes('uploads/')) return window.API_BASE + '/static/' + path;
            return `${window.API_BASE}/static/uploads/${path}`;
        }

        function hidePreloader() {
            const preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.style.opacity = '0';
                setTimeout(() => {
                    preloader.style.visibility = 'hidden';
                    preloader.style.display = 'none';
                }, 500);
            }
        }

        async function fetchData() {
            try {
                const [slidesRes, productsRes, catsRes] = await Promise.all([
                    fetch(`${window.API_BASE}/api/slides`),
                    fetch(`${window.API_BASE}/api/products?sort_by=newest`),
                    fetch(`${window.API_BASE}/api/categories`),
                ]);

                const slides = await slidesRes.json();
                const products = await productsRes.json();
                const categories = await catsRes.json();
                
                window.state.allProducts = products;

                renderSlides(slides);
                renderProducts(products);
                renderCategories(categories);

            } catch (err) {
                console.error('Error fetching data:', err);
                showNotification('–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–≥–∏—Ä–∏–∏ –º–∞—ä–ª—É–º–æ—Ç', 'error');
            }
        }

        function renderSlides(slides) {
            const heroWrapper = document.getElementById('hero-wrapper');
            if (!heroWrapper) return;

            if (!slides.length) {
                heroWrapper.innerHTML = `
                    <div class="swiper-slide relative">
                        <img src="https://images.unsplash.com/photo-1445205170230-053b83016050?auto=format&fit=crop&w=1920&q=80" class="absolute inset-0 w-full h-full object-cover" alt="Fashion">
                        <div class="absolute inset-0 bg-gradient-to-r from-dark/80 to-transparent"></div>
                        <div class="relative z-10 container mx-auto px-4 h-full flex flex-col justify-center">
                            <div class="max-w-xl text-white p-4" data-aos="fade-right">
                                <span class="inline-block px-3 py-1 bg-accent text-white text-xs font-bold rounded-full mb-4 shadow-lg shadow-accent/20">–ú–û–î–ê–ò –¢–£–†–ö”¢</span>
                                <h2 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight mb-4 drop-shadow-lg">Istanbul Fashion TJ</h2>
                                <p class="text-lg text-slate-200 mb-8 font-light">–õ–∏–±–æ—Å“≥–æ–∏ –º—É–æ—Å–∏—Ä–∏ –¢—É—Ä–∫”£ –≤–∞ –£–∑–±–µ–∫”£ –±–∞—Ä–æ–∏ —à—É–º–æ</p>
                                <a href="magazin.html" class="inline-flex items-center px-8 py-4 bg-white text-dark font-bold rounded-full transition transform hover:scale-105 hover:bg-primary hover:text-white shadow-xl">
                                    –•–∞—Ä–∏–¥ –∫–∞—Ä–¥–∞–Ω <i class="fas fa-arrow-right ml-2"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            heroWrapper.innerHTML = slides.map(slide => `
                <div class="swiper-slide relative">
                    <img src="${getImageUrl(slide.image_url || slide.image)}" class="absolute inset-0 w-full h-full object-cover" alt="${slide.title}" onerror="this.src='https://placehold.co/1920x800/292524/e7e5e4?text=Slide+Image'">
                    <div class="absolute inset-0 bg-gradient-to-r from-dark/80 to-transparent"></div>
                    <div class="relative z-10 container mx-auto px-4 h-full flex flex-col justify-center">
                        <div class="max-w-xl text-white p-4" data-aos="fade-right">
                            <span class="inline-block px-3 py-1 bg-accent text-white text-xs font-bold rounded-full mb-4 shadow-lg shadow-accent/20">–ö–û–õ–õ–ï–ö–°–ò–Ø–ò –ù–ê–í</span>
                            <h2 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight mb-4 drop-shadow-lg">${slide.title}</h2>
                            <p class="text-lg text-slate-200 mb-8 font-light">${slide.subtitle}</p>
                            <a href="${slide.link || 'magazin.html'}" class="inline-flex items-center px-8 py-4 bg-white text-dark font-bold rounded-full transition transform hover:scale-105 hover:bg-primary hover:text-white shadow-xl">
                                –î–∏–¥–∞–Ω <i class="fas fa-arrow-right ml-2"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');

            if (typeof Swiper !== 'undefined') {
                new Swiper('.hero-swiper', {
                    loop: true,
                    effect: 'fade',
                    speed: 1000,
                    autoplay: { delay: 5000, disableOnInteraction: false },
                    pagination: { el: '.swiper-pagination', clickable: true },
                    navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                });
            }
        }

        function renderCategories(categories) {
            const categoriesList = document.getElementById('mobile-categories-list');
            const desktopCategoriesDropdown = document.getElementById('desktop-categories-dropdown');
            const categoriesGrid = document.getElementById('categories-grid');

            if (!categoriesList || !desktopCategoriesDropdown || !categoriesGrid) return;

            const placeholders = [
                'https://images.unsplash.com/photo-1483985988355-763728e1935b?auto=format&fit=crop&w=500&q=80',
                'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?auto=format&fit=crop&w=500&q=80',
                'https://images.unsplash.com/photo-1542060748-10c28b62716f?auto=format&fit=crop&w=500&q=80',
                'https://images.unsplash.com/photo-1551488852-d814399e74d1?auto=format&fit=crop&w=500&q=80'
            ];

            categoriesList.innerHTML = categories.map(cat => `
                <a href="magazin.html?category=${encodeURIComponent(cat.name_tj)}" class="block px-4 py-2 text-slate-500 hover:text-primary transition flex items-center justify-between">
                    ${cat.name_tj} <span class="text-xs bg-slate-100 px-2 py-1 rounded text-slate-400">${cat.product_count || 0}</span>
                </a>
            `).join('');

            desktopCategoriesDropdown.innerHTML = categories.map(cat => `
                <a href="magazin.html?category=${encodeURIComponent(cat.name_tj)}" class="block px-3 py-2 text-sm text-slate-600 hover:bg-slate-50 hover:text-primary rounded-lg transition">
                    ${cat.name_tj}
                </a>
            `).join('');

            let displayCategories = categories;
            if (window.innerWidth < 768) {
                displayCategories = categories.slice(0, 6);
            }

            if (displayCategories.length === 0) {
                categoriesGrid.innerHTML = '<div class="col-span-full text-center text-slate-400">–ö–∞—Ç–µ–≥–æ—Ä–∏—è“≥–æ —ë—Ñ—Ç –Ω–∞—à—É–¥–∞–Ω–¥.</div>';
                return;
            }

            categoriesGrid.innerHTML = displayCategories.map((cat, idx) => {
                let imageSrc = getImageUrl(cat.image_url || cat.image); 
                
                if (!imageSrc) {
                    imageSrc = placeholders[idx % placeholders.length];
                }
                
                return `
                <a href="magazin.html?category=${encodeURIComponent(cat.name_tj)}" class="category-card block group relative overflow-hidden rounded-2xl aspect-square shadow-md hover:shadow-xl transition-all duration-300">
                    <img src="${imageSrc}" class="absolute inset-0 w-full h-full object-cover transition duration-700 group-hover:scale-110" alt="${cat.name_tj}" onerror="this.src='https://placehold.co/400?text=No+Image'">
                    <div class="category-overlay absolute inset-0 flex flex-col justify-end p-6 transition duration-300">
                        <h3 class="text-white text-xl sm:text-2xl font-bold translate-y-2 group-hover:translate-y-0 transition duration-300 drop-shadow-md">${cat.name_tj}</h3>
                        <div class="flex items-center justify-between mt-2 opacity-0 group-hover:opacity-100 translate-y-4 group-hover:translate-x-1 transition duration-300 delay-75">
                            <span class="w-10 h-10 rounded-full bg-white text-primary flex items-center justify-center shadow-lg transform group-hover:translate-x-1 transition"><i class="fas fa-arrow-right text-sm"></i></span>
                        </div>
                    </div>
                </a>
            `}).join('');
        }

        function renderProducts(products) {
            const productsGrid = document.getElementById('products-grid');
            if (!productsGrid) return;

            const latest = products.slice(0, 8);
            
            if (latest.length === 0) {
                productsGrid.innerHTML = '<div class="col-span-full text-center text-slate-400 p-8">–ú–∞“≥—Å—É–ª–æ—Ç–∏ –Ω–∞–≤ —ë—Ñ—Ç –Ω–∞—à—É–¥.</div>';
                return;
            }

            const wishlistItems = JSON.parse(localStorage.getItem('wishlist') || '[]');

            productsGrid.innerHTML = latest.map((p, idx) => {
                const price = p.price;
                const oldPrice = p.old_price ? `<span class="text-xs text-slate-400 line-through mr-2">${p.old_price} —Å.</span>` : '';
                const discount = p.old_price ? Math.round(((p.old_price - p.price) / p.old_price) * 100) : 0;
                const badge = discount > 0 ? `<div class="absolute top-3 left-3 bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md z-20">-${discount}%</div>` : '';
                
                const isInWishlist = wishlistItems.some(item => {
                    if (typeof item === 'object') {
                        return item.id === p.id;
                    }
                    return parseInt(item) === parseInt(p.id);
                });
                const heartClass = isInWishlist ? 'fas text-red-500' : 'far';

                return `
                <div class="product-card bg-white rounded-2xl p-3 shadow-soft border border-slate-50 group">
                    <div class="product-image-container relative bg-slate-100 aspect-[3/4] mb-4">
                        <a href="mahsolot.html?id=${p.id}" class="block w-full h-full">
                            <img src="${getImageUrl(p.image_url || p.image)}" class="w-full h-full object-cover" alt="${p.name_tj}" onerror="this.src='https://placehold.co/400x600/f1f5f9/94a3b8?text=No+Image'">
                        </a>
                        ${badge}
                        
                        <div class="absolute top-3 right-3 z-20">
                            <button onclick="toggleWishlist(${p.id}, this)" class="w-8 h-8 rounded-full bg-white/80 backdrop-blur text-slate-600 hover:text-red-500 hover:bg-white flex items-center justify-center transition shadow-sm">
                                <i class="${heartClass} fa-heart"></i>
                            </button>
                        </div>

                        <div class="action-overlay">
                            <a href="mahsolot.html?id=${p.id}" class="action-btn-mobile hidden sm:flex px-6 py-3 bg-white text-primary text-sm font-bold rounded-full shadow-lg hover:bg-primary hover:text-white transition items-center gap-2 transform active:scale-95 group-hover:scale-105">
                                <i class="fas fa-eye"></i> –ú—É—Ñ–∞—Å—Å–∞–ª
                            </a>
                            <a href="mahsolot.html?id=${p.id}" class="action-btn-mobile sm:hidden w-8 h-8 bg-white/90 rounded-full flex items-center justify-center">
                                <i class="fas fa-eye text-primary text-sm"></i>
                            </a>
                        </div>
                    </div>
                    <div class="px-1">
                        <p class="text-xs text-slate-500 mb-1">${p.category || '–£–º—É–º”£'}</p>
                        <a href="mahsolot.html?id=${p.id}" class="block text-sm font-bold text-dark mb-2 truncate hover:text-primary transition">${p.name_tj}</a>
                        <div class="flex items-center">
                            ${oldPrice}
                            <span class="text-primary font-bold">${price} —Å.</span>
                        </div>
                            <a href="mahsolot.html?id=${p.id}" class="mt-2 w-full flex items-center justify-center gap-2 bg-primary/10 text-primary font-semibold py-2 text-sm rounded-lg hover:bg-primary hover:text-white transition transform active:scale-95">
                                <i class="fas fa-shopping-bag text-xs"></i> –ë–∞ —Å–∞–±–∞–¥
                            </a>
                    </div>
                </div>
                `;
            }).join('');
        }

        window.toggleWishlist = async (productId, buttonElement) => {
            const product = window.state.allProducts.find(p => p.id === productId);
            if (!product) return;

            let wishlistItems = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const isInWishlist = wishlistItems.some(item => {
                if (typeof item === 'object') {
                    return item.id === productId;
                }
                return parseInt(item) === parseInt(productId);
            });

            if (isInWishlist) {
                wishlistItems = wishlistItems.filter(item => {
                    if (typeof item === 'object') {
                        return item.id !== productId;
                    }
                    return parseInt(item) !== parseInt(productId);
                });
                
                if (window.state.user.token) {
                    try {
                        await fetch(`${window.API_BASE}/api/wishlist/${productId}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${window.state.user.token}`
                            }
                        });
                    } catch (error) {
                        console.error('Error removing from server wishlist:', error);
                    }
                }
                
                buttonElement.querySelector('i').className = 'far fa-heart';
                showNotification('–ê–∑ —Ä”Ø–π—Ö–∞—Ç–∏ –æ—Ä–∑—É“≥–æ —Ö–æ—Ä–∏“∑ –∫–∞—Ä–¥–∞ —à—É–¥.', 'error');
            } else {
                const itemToAdd = {
                    id: product.id,
                    name_tj: product.name_tj,
                    price: product.price,
                    image_url: product.image_url || product.image,
                    category: product.category
                };
                
                wishlistItems.push(itemToAdd);
                
                if (window.state.user.token) {
                    try {
                        await fetch(`${window.API_BASE}/api/wishlist/${productId}`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${window.state.user.token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                    } catch (error) {
                        console.error('Error adding to server wishlist:', error);
                    }
                }
                
                buttonElement.querySelector('i').className = 'fas text-red-500 fa-heart';
                showNotification('–ë–∞ —Ä”Ø–π—Ö–∞—Ç–∏ –æ—Ä–∑—É“≥–æ –∏–ª–æ–≤–∞ —à—É–¥!', 'success');
            }

            localStorage.setItem('wishlist', JSON.stringify(wishlistItems));
            window.state.wishlist = wishlistItems;
            updateCounts();
        };

        function updateCounts() {
            const cartCount = document.getElementById('cart-count');
            const wishlistCount = document.getElementById('wishlist-count');
            
            if (cartCount) {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                cartCount.innerText = cart.reduce((a, b) => a + (b.quantity || 1), 0);
                cartCount.style.transform = cart.length > 0 ? 'scale(1)' : 'scale(0)';
            }
            
            if (wishlistCount) {
                const wishlistItems = JSON.parse(localStorage.getItem('wishlist') || '[]');
                wishlistCount.innerText = wishlistItems.length;
                wishlistCount.style.transform = wishlistItems.length > 0 ? 'scale(1)' : 'scale(0)';
            }
        }

        function renderUser() {
            const userSection = document.getElementById('user-section');
            const mobileUserCard = document.getElementById('mobile-user-card');
            
            if (!userSection || !mobileUserCard) return;

            if (window.state.user.token) {
                const userName = window.state.user.name || '–ú—É—à—Ç–∞—Ä”£';
                const userInitial = userName.charAt(0).toUpperCase();
                
                userSection.innerHTML = `
                    <div class="relative group cursor-pointer ml-2">
                        <div class="w-9 h-9 rounded-full bg-gradient-to-tr from-primary to-accent text-white flex items-center justify-center font-bold shadow-lg">
                            ${userInitial}
                        </div>
                        <div class="absolute right-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0 w-48 z-50">
                            <div class="bg-white rounded-xl shadow-soft p-2 border border-slate-100">
                                <div class="px-3 py-2 border-b border-slate-100 mb-1">
                                    <p class="font-bold text-sm text-dark truncate">${userName}</p>
                                    <p class="text-xs text-slate-500">–ú—É—à—Ç–∞—Ä”£</p>
                                </div>
                                <a href="account.html" class="block px-3 py-2 text-sm text-slate-600 hover:bg-slate-50 hover:text-primary rounded-lg transition"><i class="fas fa-user-circle mr-2"></i> –ö–∞–±–∏–Ω–µ—Ç</a>
                                <button onclick="logout()" class="w-full text-left px-3 py-2 text-sm text-red-500 hover:bg-red-50 rounded-lg transition"><i class="fas fa-sign-out-alt mr-2"></i> –ë–∞—Ä–æ–º–∞–¥</button>
                            </div>
                        </div>
                    </div>
                `;
                
                mobileUserCard.innerHTML = `
                    <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-primary to-accent text-white flex items-center justify-center font-bold text-xl shadow-md">
                        ${userInitial}
                    </div>
                    <div class="flex-1">
                        <p class="font-bold text-dark">${userName}</p>
                        <button onclick="logout()" class="text-xs text-red-500 font-medium hover:underline">–ë–∞—Ä–æ–º–∞–¥ –∫–∞—Ä–¥–∞–Ω</button>
                    </div>
                    <a href="account.html" class="px-4 py-2 bg-primary text-white text-xs font-bold rounded-lg shadow-lg shadow-primary/30">–ö–∞–±–∏–Ω–µ—Ç</a>
                `;
            } else {
                const loginBtn = `<a href="sabtinom.html" class="ml-2 px-5 py-2 bg-dark text-white text-sm font-semibold rounded-full hover:bg-primary transition shadow-lg hover:shadow-primary/30">–í–æ—Ä–∏–¥—à–∞–≤”£</a>`;
                userSection.innerHTML = loginBtn;
                
                mobileUserCard.innerHTML = `
                    <div class="w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center text-slate-400 text-xl">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="flex-1">
                        <p class="font-bold text-dark">–•—É—à –æ–º–∞–¥–µ–¥!</p>
                        <p class="text-xs text-slate-500">–ë–∞—Ä–æ–∏ —Ö–∞—Ä–∏–¥ –≤–æ—Ä–∏–¥ —à–∞–≤–µ–¥</p>
                    </div>
                    <a href="sabtinom.html" class="px-4 py-2 bg-primary text-white text-xs font-bold rounded-lg shadow-lg shadow-primary/30">–í–æ—Ä–∏–¥</a>
                `;
            }
        }

        window.logout = () => {
            localStorage.removeItem('userToken');
            localStorage.removeItem('userName');
            localStorage.removeItem('userRole');
            localStorage.removeItem('userId');
            localStorage.removeItem('userEmail');
            window.location.reload();
        };

        function setupSubscribeForm() {
            const subscribeForm = document.getElementById('subscribe-form');
            if (!subscribeForm) return;

            subscribeForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('sub-email').value.trim();
                const msg = document.getElementById('sub-message');
                
                if (!email || !email.includes('@')) {
                    msg.innerText = "–ü–æ—á—Ç–∞–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∏ –Ω–æ–¥—É—Ä—É—Å—Ç";
                    msg.className = "text-sm mt-3 h-5 font-bold text-red-400";
                    return;
                }

                msg.innerText = "–†–∞–≤–æ–Ω –∫–∞—Ä–¥–∞ –º–µ—à–∞–≤–∞–¥...";
                msg.className = "text-sm mt-3 h-5 font-bold text-slate-300";

                try {
                    const res = await fetch(`${window.API_BASE}/api/subscribe`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: email })
                    });
                    
                    const data = await res.json();
                    
                    if(res.ok) {
                        msg.innerText = data.message;
                        msg.className = "text-sm mt-3 h-5 font-bold text-green-400";
                        showNotification(data.message, 'success');
                        subscribeForm.reset();
                    } else {
                        msg.innerText = data.error || data.message;
                        msg.className = "text-sm mt-3 h-5 font-bold text-red-400";
                        showNotification(data.error || '–•–∞—Ç–æ–≥”£ —Ä”Ø–π –¥–æ–¥', 'error');
                    }
                } catch(e) {
                    msg.innerText = "–•–∞—Ç–æ–≥”£ –¥–∞—Ä –ø–∞–π–≤–∞—Å—Ç—à–∞–≤”£";
                    msg.className = "text-sm mt-3 h-5 font-bold text-red-400";
                    showNotification('–•–∞—Ç–æ–≥”£ –¥–∞—Ä –ø–∞–π–≤–∞—Å—Ç—à–∞–≤”£', 'error');
                }
            });
        }

        function setupMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            
            if (!mobileMenuBtn || !closeMenuBtn || !mobileMenu || !mobileMenuOverlay) return;

            function toggleMenu() {
                const isOpen = mobileMenu.classList.contains('open');
                
                if(isOpen) {
                    mobileMenu.classList.remove('open');
                    mobileMenuOverlay.classList.add('hidden');
                    document.body.style.overflow = '';
                } else {
                    mobileMenu.classList.add('open');
                    mobileMenuOverlay.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                }
            }
            
            mobileMenuBtn.addEventListener('click', toggleMenu);
            closeMenuBtn.addEventListener('click', toggleMenu);
            mobileMenuOverlay.addEventListener('click', toggleMenu);
        }

        function setupSearch() {
            const desktopSearchInput = document.getElementById('desktop-search-input');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            
            function handleSearch(e) {
                if (e.key === 'Enter') {
                    const query = e.target.value.trim();
                    if (query) {
                        window.location.href = `magazin.html?q=${encodeURIComponent(query)}`;
                    }
                }
            }
            
            if (desktopSearchInput) {
                desktopSearchInput.addEventListener('keydown', handleSearch);
            }
            
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('keydown', handleSearch);
            }
        }

        function initAOS() {
            if (typeof AOS !== 'undefined') {
                AOS.init({ 
                    duration: 800, 
                    offset: 50, 
                    once: true,
                    disable: window.innerWidth < 768 ? true : false
                });
            }
        }

        async function testChatConnection() {
            try {
                const response = await fetch(window.API_BASE + '/api/chat/test');
                if (response.ok) {
                    console.log('‚úÖ Chat API connected successfully');
                } else {
                    console.warn('‚ö†Ô∏è Chat API connection issue');
                }
            } catch (error) {
                console.error('‚ùå Chat API connection failed:', error);
            }
        }

        function initChatWidget() {
            const els = {
                widget: document.getElementById('ai-chat-widget'),
                window: document.getElementById('chat-window'),
                toggleBtn: document.getElementById('chat-toggle-btn'),
                closeBtn: document.getElementById('close-chat'),
                messages: document.getElementById('chat-messages'),
                form: document.getElementById('chat-form'),
                input: document.getElementById('chat-input'),
                submitBtn: document.getElementById('chat-submit-btn'),
                backdrop: document.getElementById('chat-backdrop'),
                suggestions: document.querySelectorAll('.suggestion-btn')
            };

            let isOpen = false;

            function toggleChat() {
                isOpen = !isOpen;
                
                if (isOpen) {
                    els.window.classList.remove('invisible', 'opacity-0', 'translate-y-4');
                    els.window.classList.add('visible', 'opacity-100', 'translate-y-0');
                    els.toggleBtn.classList.add('scale-0', 'opacity-0');
                    
                    if (window.innerWidth < 768) {
                        els.backdrop.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                        setTimeout(() => els.backdrop.classList.remove('opacity-0'), 10);
                    }
                    
                    setTimeout(() => {
                        els.input.focus();
                        scrollToBottom();
                    }, 300);
                } else {
                    els.window.classList.remove('visible', 'opacity-100', 'translate-y-0');
                    els.window.classList.add('invisible', 'opacity-0', 'translate-y-4');
                    els.toggleBtn.classList.remove('scale-0', 'opacity-0');
                    
                    if (window.innerWidth < 768) {
                        els.backdrop.classList.add('opacity-0');
                        document.body.style.overflow = '';
                        setTimeout(() => els.backdrop.classList.add('hidden'), 300);
                    }
                }
            }

            function scrollToBottom() {
                els.messages.scrollTop = els.messages.scrollHeight;
            }

            function appendUserMessage(text) {
                const div = document.createElement('div');
                div.className = 'flex items-end justify-end gap-2 max-w-[85%] ml-auto animate-fade-in';
                div.innerHTML = `
                    <div class="bg-primary text-white p-3.5 chat-bubble-user text-sm shadow-md leading-relaxed break-words">
                        ${text.replace(/</g, "&lt;").replace(/>/g, "&gt;")}
                    </div>
                `;
                els.messages.appendChild(div);
                scrollToBottom();
            }

            function appendBotMessage(text) {
                const div = document.createElement('div');
                div.className = 'flex items-end gap-2 max-w-[85%] animate-fade-in';
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-primary text-xs shrink-0 shadow-sm border border-slate-100">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="bg-white p-3.5 chat-bubble-bot text-sm text-slate-700 leading-relaxed shadow-[0_2px_5px_rgba(0,0,0,0.02)] break-words">
                        ${text}
                    </div>
                `;
                els.messages.appendChild(div);
                scrollToBottom();
            }

            function showTyping() {
                const div = document.createElement('div');
                div.id = 'typing-indicator';
                div.className = 'flex items-end gap-2 max-w-[85%] animate-fade-in';
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-primary text-xs shrink-0 shadow-sm border border-slate-100">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="bg-white p-4 chat-bubble-bot shadow-sm flex gap-1 items-center h-10">
                        <span class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"></span>
                        <span class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></span>
                        <span class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                    </div>
                `;
                els.messages.appendChild(div);
                scrollToBottom();
            }

            function removeTyping() {
                const typing = document.getElementById('typing-indicator');
                if (typing) typing.remove();
            }

            async function sendChatMessage(text) {
                try {
                    const response = await fetch(window.API_BASE + '/api/chat', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ message: text })
                    });

                    removeTyping();

                    if (response.ok) {
                        const data = await response.json();
                        appendBotMessage(data.answer);
                    } else {
                        const errorData = await response.text();
                        console.error('Server Error:', errorData);
                        appendBotMessage('–•–∞—Ç–æ–≥”£ –¥–∞—Ä —Å–µ—Ä–≤–µ—Ä. –õ—É—Ç—Ñ–∞–Ω –±–∞—ä–¥—Ç–∞—Ä –∫”Ø—à–∏—à –∫—É–Ω–µ–¥.');
                    }
                } catch (error) {
                    console.error('Network Error:', error);
                    removeTyping();
                    appendBotMessage('–•–∞—Ç–æ–≥”£ –¥–∞—Ä —à–∞–±–∞–∫–∞. –õ—É—Ç—Ñ–∞–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ä–æ —Ç–∞—Ñ—Ç–∏—à –∫—É–Ω–µ–¥.');
                }
            }
            
            // Logic to handle message submission
            async function handleMessageSubmit() {
                const text = els.input.value.trim();
                if (!text) return;

                appendUserMessage(text);
                els.input.value = '';
                els.input.style.height = 'auto'; 
                els.input.disabled = true;
                els.submitBtn.disabled = true;

                showTyping();

                await sendChatMessage(text);

                els.input.disabled = false;
                els.submitBtn.disabled = false;
                els.input.focus();
            }

            // Click listener for the BUTTON (now type="button")
            if (els.submitBtn) {
                els.submitBtn.addEventListener('click', (e) => {
                    e.preventDefault(); // Good practice
                    handleMessageSubmit();
                });
            }

            // Keydown listener for the INPUT
            if (els.input) {
                els.input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault(); // Stop newline
                        handleMessageSubmit(); // Call logic directly
                    }
                });
                
                els.input.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                    if(this.value === '') this.style.height = 'auto';
                });
            }

            // Suggestions listener
            els.suggestions.forEach(btn => {
                btn.addEventListener('click', () => {
                   els.input.value = btn.innerText;
                   handleMessageSubmit();
                });
            });

            if (els.toggleBtn) els.toggleBtn.addEventListener('click', toggleChat);
            if (els.closeBtn) els.closeBtn.addEventListener('click', toggleChat);
            if (els.backdrop) els.backdrop.addEventListener('click', toggleChat);

            window.toggleChat = toggleChat;
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.state = {
                cart: JSON.parse(localStorage.getItem('cart') || '[]'),
                wishlist: JSON.parse(localStorage.getItem('wishlist') || '[]'),
                allProducts: [], 
                user: {
                    token: localStorage.getItem('userToken'),
                    name: localStorage.getItem('userName'),
                    id: localStorage.getItem('userId'),
                    email: localStorage.getItem('userEmail'),
                    role: localStorage.getItem('userRole')
                }
            };

            initAOS();
            
            setTimeout(hidePreloader, 1500);
            
            setupMobileMenu();
            
            setupSearch();
            
            setupSubscribeForm();
            
            updateCounts();
            
            renderUser();
            
            fetchData();
            
            testChatConnection();
            
            initChatWidget();
            
            window.addEventListener('resize', () => {
                if (typeof AOS !== 'undefined') {
                    AOS.refresh();
                }
            });
        });
    </script>
</body>
</html>
